# Расположение папки native-libs

**Дата:** 2025-11-28  
**Версия:** 0.1.0.1-SNAPSHOT

## Где должна находиться native-libs?

**Ответ: Рядом с тонким JAR, а не в `lib/`**

### Правильная структура:

```
C:\femsq\
├── femsq-web-0.1.0.1-SNAPSHOT-thin.jar  (тонкий JAR)
├── native-libs\                          ← ЗДЕСЬ (рядом с JAR)
│   ├── mssql-jdbc_auth-12.8.1.x64.dll
│   ├── mssql-jdbc_auth-12.8.1.x86.dll
│   └── sqljdbc_auth.dll
└── lib\                                   (библиотеки)
    ├── jasperreports-7.0.3.jar
    └── ... (остальные библиотеки)
```

### Неправильная структура:

```
C:\femsq\
├── femsq-web-0.1.0.1-SNAPSHOT-thin.jar
└── lib\
    ├── native-libs\                      ← НЕПРАВИЛЬНО (в lib/)
    │   └── ...
    └── ... (библиотеки)
```

## Как это работает?

1. **При запуске приложения:**
   - `NativeLibraryLoader` определяет директорию, где находится тонкий JAR
   - Создаёт папку `native-libs/` рядом с тонким JAR
   - Извлекает DLL файлы из тонкого JAR в `native-libs/`
   - Добавляет `native-libs/` в `PATH` для загрузки DLL

2. **Определение директории JAR:**
   - Приложение пытается определить директорию через `FemsqWebApplication.class`
   - Если это не удаётся, использует текущую рабочую директорию
   - Проверяет, что это не вложенный JAR из `lib/`

3. **Автоматическое создание:**
   - Папка `native-libs/` создаётся автоматически при первом запуске
   - DLL файлы извлекаются из тонкого JAR автоматически
   - Не требуется ручное создание или копирование

## Для Windows

В `start.bat` папка `native-libs/` добавляется в `PATH`:

```batch
set "NATIVE_LIBS_DIR=%SCRIPT_DIR%native-libs"
set "PATH=%NATIVE_LIBS_DIR%;%PATH%"
```

Это обеспечивает, что Windows сможет найти DLL файлы для Windows Authentication.

## Важные замечания

⚠️ **Не размещайте `native-libs/` в `lib/`** - это неправильно и может привести к проблемам с определением пути.

✅ **Папка создаётся автоматически** - не нужно создавать её вручную.

✅ **DLL извлекаются автоматически** - они уже включены в тонкий JAR и извлекаются при первом запуске.