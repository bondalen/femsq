# Windows Authentication –≤ FEMSQ

**–î–∞—Ç–∞:** 2025-11-19  
**–í–µ—Ä—Å–∏—è:** 0.1.0.1-SNAPSHOT  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

FEMSQ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Windows Integrated Authentication –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ SQL Server –±–µ–∑ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Ç–∏–≤–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É `mssql-jdbc_auth.dll`, –∫–æ—Ç–æ—Ä–∞—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ JAR –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Java 21+
- Visual C++ Redistributable 2015-2022 x64
- –ö–æ–º–ø—å—é—Ç–µ—Ä –≤ –¥–æ–º–µ–Ω–µ Windows
- SQL Server —Å Windows Authentication

---

## üìñ –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ü–æ–ø—ã—Ç–∫–∏ –±–µ–∑ DLL (–Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏)

–í —Ö–æ–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±—ã–ª–∏ –æ–ø—Ä–æ–±–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–¥—Ö–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ **–Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏**:

#### 1. JavaKerberos —Å native SSPI
- **–ü–æ–¥—Ö–æ–¥:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `sun.security.jgss.native=true` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Windows Kerberos tickets —á–µ—Ä–µ–∑ JNI
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ "Unable to obtain Principal Name for authentication"
- **–ü—Ä–∏—á–∏–Ω–∞:** Microsoft JDBC Driver —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—É—é JAAS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é —Å–ª–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ

#### 2. NTLM authentication scheme
- **–ü–æ–¥—Ö–æ–¥:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `authenticationScheme=NTLM` —Å `domain\username`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ "Login failed for user"
- **–ü—Ä–∏—á–∏–Ω–∞:** NTLM –≤ Java —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω—ã–π –ø–∞—Ä–æ–ª—å, –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç SSO –±–µ–∑ DLL

#### 3. Credentials mode
- **–ü–æ–¥—Ö–æ–¥:** –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ `username` –∏ `password`
- **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è (–Ω–µ SSO)

### –†–∞–±–æ—á–µ–µ —Ä–µ—à–µ–Ω–∏–µ

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `integratedSecurity=true` —Å –Ω–∞—Ç–∏–≤–Ω–æ–π DLL `mssql-jdbc_auth.dll`.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `NativeLibraryLoader` –∏–∑–≤–ª–µ–∫–∞–µ—Ç DLL –∏–∑ JAR –≤ –ø–∞–ø–∫—É `native-libs/` —Ä—è–¥–æ–º —Å JAR
2. DLL –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `System.load()` —Å –ø–æ–ª–Ω—ã–º –ø—É—Ç—ë–º
3. Microsoft JDBC Driver –∏—Å–ø–æ–ª—å–∑—É–µ—Ç DLL –¥–ª—è Windows SSPI (Kerberos/NTLM)
4. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —Ç–µ–∫—É—â–∏–µ Windows credentials

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–æ–ª–Ω—ã–π SSO (Single Sign-On) - –Ω–µ –Ω—É–∂–µ–Ω –ø–∞—Ä–æ–ª—å
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ SSMS - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ DLL –∏–∑ JAR
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ü–û (–∫—Ä–æ–º–µ Visual C++ Runtime, –æ–±—ã—á–Ω–æ —É–∂–µ –µ—Å—Ç—å)

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Java Runtime Environment (JRE) 21+**
   ```cmd
   java -version
   ```

2. **Visual C++ Redistributable 2015-2022 x64**
   ```cmd
   where vcruntime140.dll msvcp140.dll
   ```
   –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã: https://aka.ms/vs/17/release/vc_redist.x64.exe

3. **–ö–æ–º–ø—å—é—Ç–µ—Ä –≤ –¥–æ–º–µ–Ω–µ Windows**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –≤ –¥–æ–º–µ–Ω–µ

### –§–∞–π–ª—ã –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

```
deployment/
‚îú‚îÄ‚îÄ femsq-web-0.1.0.1-SNAPSHOT.jar    (30 MB)
‚îî‚îÄ‚îÄ start.bat                          (—Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞)
```

### –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

1. **–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   ```cmd
   mkdir D:\Programs\FEMSQ
   cd D:\Programs\FEMSQ
   ```

2. **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã:**
   - `femsq-web-0.1.0.1-SNAPSHOT.jar`
   - `start.bat` (—Å–º. –Ω–∏–∂–µ)

3. **–°–æ–∑–¥–∞—Ç—å `start.bat`:**
   ```batch
   @echo off
   set PATH=%~dp0native-libs;%PATH%
   java -jar femsq-web-0.1.0.1-SNAPSHOT.jar
   ```

**–í–∞–∂–Ω–æ:** –í–°–ï–ì–î–ê –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `start.bat`, –∞ –Ω–µ –Ω–∞–ø—Ä—è–º—É—é JAR!

---

## üöÄ –ó–∞–ø—É—Å–∫

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `start.bat`

2. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   - –°–æ–∑–¥–∞—Å—Ç –ø–∞–ø–∫—É `native-libs/` —Ä—è–¥–æ–º —Å JAR
   - –ò–∑–≤–ª–µ—á—ë—Ç `mssql-jdbc_auth-12.8.1.x64.dll` –∏ –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã
   - –°–æ–∑–¥–∞—Å—Ç –ø–∞–ø–∫—É `logs/` –¥–ª—è –ª–æ–≥–æ–≤

3. –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
   ```
   INFO: Pre-loaded native library via System.load() from: D:\...\native-libs\mssql-jdbc_auth-12.8.1.x64.dll
   INFO: Successfully loaded mssql-jdbc_auth library for Windows Authentication
   INFO: Using Windows SSPI for integrated authentication (Kerberos/NTLM auto-select)
   Started FemsqWebApplication in X.XXX seconds
   ```

4. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ http://localhost:8080

### –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏

–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ `start.bat` - –≤—Å—ë –≥–æ—Ç–æ–≤–æ!

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```
D:\Programs\FEMSQ\
‚îú‚îÄ‚îÄ femsq-web-0.1.0.1-SNAPSHOT.jar
‚îú‚îÄ‚îÄ start.bat
‚îú‚îÄ‚îÄ native-libs/                     (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ mssql-jdbc_auth-12.8.1.x64.dll
‚îÇ   ‚îú‚îÄ‚îÄ mssql-jdbc_auth.dll
‚îÇ   ‚îî‚îÄ‚îÄ sqljdbc_auth.dll
‚îî‚îÄ‚îÄ logs/                            (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    ‚îî‚îÄ‚îÄ connection-attempts.log
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

1. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å:**
   ```
   Started FemsqWebApplication in X.XXX seconds
   ```

2. **–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
   ```
   http://localhost:8080
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:**
   - –í—ã–±–µ—Ä–∏—Ç–µ "Windows Authentication"
   - –£–∫–∞–∂–∏—Ç–µ —Ö–æ—Å—Ç SQL Server
   - –ù–∞–∂–º–∏—Ç–µ "Test Connection"
   - **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Connection successful

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### "–ù–µ —É–¥–∞–µ—Ç—Å—è –Ω–∞–π—Ç–∏ –∑–∞–≤–∏—Å–∏–º—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É DLL"

**–ü—Ä–∏—á–∏–Ω–∞:** Visual C++ Runtime –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```cmd
REM –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
where vcruntime140.dll msvcp140.dll

REM –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
vc_redist.x64.exe
```

### "Login failed for user"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –≤ SQL Server

**–†–µ—à–µ–Ω–∏–µ:** –ù–∞ SQL Server –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
```sql
CREATE LOGIN [DOMAIN\username] FROM WINDOWS;
USE YourDatabase;
CREATE USER [DOMAIN\username] FOR LOGIN [DOMAIN\username];
ALTER ROLE db_datareader ADD MEMBER [DOMAIN\username];
```

### "–≠—Ç–æ—Ç –¥—Ä–∞–π–≤–µ—Ä –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏"

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–ø—É—Å—Ç–∏–ª–∏ JAR –Ω–∞–ø—Ä—è–º—É—é, –∞ –Ω–µ —á–µ—Ä–µ–∑ `start.bat`

**–†–µ—à–µ–Ω–∏–µ:** –í–°–ï–ì–î–ê –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —á–µ—Ä–µ–∑ `start.bat`!

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```cmd
REM –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Java
java -version

REM –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏
java -jar femsq-web-0.1.0.1-SNAPSHOT.jar --debug
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `start.bat` –¥–ª—è –∑–∞–ø—É—Å–∫–∞**
   - –ë–∞—Ç–Ω–∏–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç `native-libs` –≤ PATH
   - –ë–µ–∑ —ç—Ç–æ–≥–æ DLL –Ω–µ –Ω–∞–π–¥—ë—Ç—Å—è

2. **–ü–∞–ø–∫–∞ `native-libs` —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
   - –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
   - –†—è–¥–æ–º —Å JAR —Ñ–∞–π–ª–æ–º
   - –ù–ï —É–¥–∞–ª—è–π—Ç–µ –µ—ë!

3. **Visual C++ Runtime –û–ë–Ø–ó–ê–¢–ï–õ–ï–ù**
   - –ë–µ–∑ –Ω–µ–≥–æ DLL –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
   - –û–±—ã—á–Ω–æ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Windows

4. **–ö–æ–º–ø—å—é—Ç–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –¥–æ–º–µ–Ω–µ**
   - Windows Authentication —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –¥–æ–º–µ–Ω–µ
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ DLL

1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `NativeLibraryLoader.ensureSqlServerAuthLibrary()`
2. DLL –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ JAR –≤ –∫–∞—Ç–∞–ª–æ–≥ `native-libs/` —Ä—è–¥–æ–º —Å JAR
3. –ü—É—Ç—å –∫ –∫–∞—Ç–∞–ª–æ–≥—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `java.library.path`
4. DLL –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `System.load()` —Å –ø–æ–ª–Ω—ã–º –ø—É—Ç—ë–º
5. –ö–æ–≥–¥–∞ –¥—Ä–∞–π–≤–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç `System.loadLibrary("mssql-jdbc_auth-12.8.1.x64")`, –æ–Ω –Ω–∞—Ö–æ–¥–∏—Ç DLL –≤ `java.library.path`

### –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª—ã:**
- `femsq-database/src/main/java/com/femsq/database/auth/NativeLibraryLoader.java` - –∑–∞–≥—Ä—É–∑–∫–∞ DLL
- `femsq-database/src/main/java/com/femsq/database/auth/WindowsIntegratedAuthenticationProvider.java` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `integratedSecurity=true`
- `femsq-web/src/main/java/com/femsq/web/FemsqWebApplication.java` - –≤—ã–∑–æ–≤ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `logs/connection-attempts.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `start.bat`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Visual C++ Runtime —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-19  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0.0
