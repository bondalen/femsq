# Настройка Java 21 для запуска FEMSQ на Windows

**Дата:** 2025-12-01  
**Версия:** 0.1.0.1-SNAPSHOT

## Проблема

На машинах Windows часто установлена устаревшая версия Java по умолчанию (например, Java 8 или Java 11). Приложение FEMSQ требует **Java 21 или выше** для корректной работы.

## Решение

Скрипт `start.bat` поддерживает несколько способов указания пути к Java 21. Выберите наиболее удобный для вас вариант.

## Варианты настройки

### Вариант 1: Конфигурационный файл (рекомендуется)

**Преимущества:**
- Не требует изменения системных настроек
- Легко обновить при изменении пути
- Работает для всех пользователей на машине

**Шаги:**

1. **Скопируйте пример конфигурационного файла:**
   ```cmd
   copy java21-config.bat.example java21-config.bat
   ```

2. **Откройте `java21-config.bat` в текстовом редакторе** (Блокнот, Notepad++ и т.д.)

3. **Укажите путь к Java 21:**
   ```batch
   set "JAVA21_HOME=C:\Program Files\Java\jdk-21"
   set "JAVA21_EXE=%JAVA21_HOME%\bin\java.exe"
   ```
   
   Замените `C:\Program Files\Java\jdk-21` на ваш реальный путь к Java 21.

4. **Сохраните файл**

5. **Запустите приложение:**
   ```cmd
   start.bat
   ```

**Примеры путей:**
- `C:\Program Files\Java\jdk-21`
- `C:\Program Files\Eclipse Adoptium\jdk-21.0.1-hotspot`
- `D:\java\jdk-21`
- `C:\Program Files\Java\jdk-21.0.2`

### Вариант 2: Переменная окружения

**Преимущества:**
- Работает для всех приложений
- Не требует создания дополнительных файлов

**Шаги:**

1. **Откройте командную строку от имени администратора**

2. **Установите переменную окружения:**
   ```cmd
   setx JAVA21_EXE "C:\Program Files\Java\jdk-21\bin\java.exe" /M
   ```
   
   Замените путь на ваш реальный путь к Java 21.
   
   **Примечание:** `/M` устанавливает системную переменную (требует прав администратора).  
   Без `/M` устанавливается переменная для текущего пользователя.

3. **Перезапустите командную строку** (чтобы переменная вступила в силу)

4. **Запустите приложение:**
   ```cmd
   start.bat
   ```

### Вариант 3: Параметр при запуске

**Преимущества:**
- Не требует настройки
- Можно использовать разные версии Java для разных запусков

**Шаги:**

1. **Запустите приложение с указанием пути к Java 21:**
   ```cmd
   start.bat femsq-web-0.1.0.1-SNAPSHOT-thin.jar "C:\Program Files\Java\jdk-21\bin\java.exe"
   ```

2. **Или создайте ярлык** с этой командой для удобства

### Вариант 4: Автоматический поиск

**Преимущества:**
- Не требует настройки, если Java 21 установлена в стандартном месте

**Как это работает:**

Скрипт `start.bat` автоматически ищет Java 21 в следующих местах:
- `C:\Program Files\Java\jdk-21\bin\java.exe`
- `C:\Program Files\Java\jdk-21.0.1\bin\java.exe`
- `C:\Program Files\Java\jdk-21.0.2\bin\java.exe`
- `C:\Program Files\Eclipse Adoptium\jdk-21.0.1-hotspot\bin\java.exe`
- `C:\Program Files\Eclipse Adoptium\jdk-21.0.2-hotspot\bin\java.exe`
- `D:\java\jdk-21\bin\java.exe`
- `D:\java\jdk-21.0.1\bin\java.exe`
- `C:\Program Files (x86)\Java\jdk-21\bin\java.exe`

Если Java 21 найдена в одном из этих мест, она будет использована автоматически.

## Приоритет определения Java

Скрипт использует следующий приоритет при определении пути к Java:

1. **Параметр командной строки** (если указан)
2. **Переменная окружения `JAVA21_EXE`**
3. **Конфигурационный файл `java21-config.bat`**
4. **Автоматический поиск** в стандартных местах
5. **Системная Java из PATH** (с предупреждением)

## Проверка настройки

После настройки проверьте:

1. **Запустите скрипт:**
   ```cmd
   start.bat
   ```

2. **Проверьте вывод:**
   - Должно быть сообщение: `[OK] Java найдена и доступна`
   - Должно быть указано: `[INFO] Используется Java: <путь>`

3. **Если используется неправильная версия Java:**
   - Скрипт выведет предупреждение
   - Приложение может не запуститься или работать некорректно

## Установка Java 21

Если Java 21 не установлена, вы можете скачать её:

1. **Eclipse Adoptium (рекомендуется):**
   - Сайт: https://adoptium.net/
   - Выберите: Java 21 (LTS), Windows, x64
   - Установите в стандартное место: `C:\Program Files\Eclipse Adoptium\jdk-21.x.x-hotspot`

2. **Oracle JDK:**
   - Сайт: https://www.oracle.com/java/technologies/downloads/#java21
   - Требуется регистрация (бесплатно для личного использования)

3. **Microsoft Build of OpenJDK:**
   - Сайт: https://learn.microsoft.com/en-us/java/openjdk/download
   - Выберите: Java 21 (LTS)

## Решение проблем

### Проблема: "Java 21 не найдена"

**Решение:**
1. Убедитесь, что Java 21 установлена
2. Проверьте путь к Java 21: `dir "C:\Program Files\Java\jdk-21\bin\java.exe"`
3. Используйте один из вариантов настройки выше

### Проблема: "Используется системная Java из PATH"

**Решение:**
1. Это означает, что Java 21 не найдена автоматически
2. Используйте Вариант 1 (конфигурационный файл) или Вариант 2 (переменная окружения)

### Проблема: "Не удалось определить версию Java"

**Решение:**
1. Проверьте, что путь к Java указан правильно
2. Проверьте, что файл `java.exe` существует по указанному пути
3. Попробуйте запустить Java вручную: `"C:\Program Files\Java\jdk-21\bin\java.exe" -version`

### Проблема: Приложение не запускается с Java 21

**Решение:**
1. Проверьте версию Java: `"C:\Program Files\Java\jdk-21\bin\java.exe" -version`
2. Убедитесь, что это действительно Java 21 или выше
3. Используйте `start-debug.bat` для диагностики

## Примеры конфигурационных файлов

### Пример 1: Стандартная установка
```batch
set "JAVA21_HOME=C:\Program Files\Java\jdk-21"
set "JAVA21_EXE=%JAVA21_HOME%\bin\java.exe"
```

### Пример 2: Eclipse Adoptium
```batch
set "JAVA21_HOME=C:\Program Files\Eclipse Adoptium\jdk-21.0.1-hotspot"
set "JAVA21_EXE=%JAVA21_HOME%\bin\java.exe"
```

### Пример 3: Пользовательская установка
```batch
set "JAVA21_HOME=D:\java\jdk-21"
set "JAVA21_EXE=%JAVA21_HOME%\bin\java.exe"
```

## Дополнительная информация

- Скрипт `start.bat` автоматически определяет путь к Java 21, если она установлена в стандартном месте
- Конфигурационный файл `java21-config.bat` имеет приоритет над автоматическим поиском
- Переменная окружения `JAVA21_EXE` имеет приоритет над конфигурационным файлом
- Параметр командной строки имеет наивысший приоритет
