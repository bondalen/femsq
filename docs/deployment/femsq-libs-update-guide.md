# Руководство по обновлению библиотек femsq-*

## Обзор

Библиотеки `femsq-*.jar` являются модулями проекта и должны соответствовать версии тонкого JAR. При несовпадении версий приложение выдаст предупреждение при запуске.

## Библиотеки femsq-*

В проекте используются следующие библиотеки femsq-*:

- **femsq-database-*.jar** - модуль работы с базой данных
- **femsq-reports-*.jar** - модуль отчётов

**Важно:** Эти библиотеки должны находиться в папке `lib/` на машине пользователя и иметь ту же версию, что и тонкий JAR.

## Процесс обновления

### Шаг 1: Получение предупреждения

При запуске тонкого JAR на машине пользователя вы можете увидеть предупреждение в логе:

```
[WARN] Version mismatch for femsq-database-0.1.0.1-SNAPSHOT.jar: expected 0.1.0.19-SNAPSHOT, found 0.1.0.1-SNAPSHOT
[WARN] Version mismatch for femsq-reports-0.1.0.1-SNAPSHOT.jar: expected 0.1.0.19-SNAPSHOT, found 0.1.0.1-SNAPSHOT
```

Это означает, что версии библиотек в папке `lib/` не соответствуют версии тонкого JAR.

### Шаг 2: Извлечение библиотек из толстого JAR (на машине разработки)

На машине разработки выполните:

```bash
cd /path/to/femsq
./code/scripts/extract-femsq-libs.sh
```

Скрипт извлечёт все библиотеки `femsq-*.jar` из толстого JAR в директорию:
```
code/femsq-backend/femsq-web/target/extracted-femsq-libs/
```

**Альтернативно:** Можно указать путь к толстому JAR и выходную директорию:

```bash
./code/scripts/extract-femsq-libs.sh \
  /path/to/femsq-web-0.1.0.19-SNAPSHOT.jar \
  /path/to/output/directory
```

### Шаг 3: Перенос библиотек на машину пользователя

Скопируйте все извлечённые JAR файлы на машину пользователя в папку `lib/`:

**На Linux (машина разработки):**
```bash
# Создать архив для переноса
cd code/femsq-backend/femsq-web/target/extracted-femsq-libs/
zip femsq-libs-update.zip femsq-*.jar
```

**На Windows (машина пользователя):**
1. Распакуйте архив `femsq-libs-update.zip` во временную папку
2. Скопируйте все файлы `femsq-*.jar` в папку `lib/` рядом с тонким JAR
3. Замените старые версии библиотек

**Пример структуры на машине пользователя:**
```
C:\femsq\
├── femsq-web-0.1.0.19-SNAPSHOT-thin.jar
├── lib\
│   ├── femsq-database-0.1.0.19-SNAPSHOT.jar  ← обновлено
│   ├── femsq-reports-0.1.0.19-SNAPSHOT.jar   ← обновлено
│   └── ... (другие библиотеки)
└── native-libs\
```

### Шаг 4: Проверка обновления

После обновления библиотек запустите приложение снова:

```batch
start-with-logging.bat "D:\java\jdk-21\bin\java.exe"
```

Предупреждения о несовпадении версий должны исчезнуть.

## Автоматизация (опционально)

Можно создать скрипт для автоматического создания архива обновления:

```bash
#!/bin/bash
# create-femsq-libs-update.sh
# Создаёт архив с библиотеками femsq-* для обновления

VERSION=$(grep -oP '<version>\K[^<]+' code/pom.xml | head -1 | sed 's/-SNAPSHOT//')
OUTPUT_DIR="code/femsq-backend/femsq-web/target/extracted-femsq-libs"
ARCHIVE_NAME="femsq-libs-update-${VERSION}.zip"

# Извлечь библиотеки
./code/scripts/extract-femsq-libs.sh

# Создать архив
cd "$OUTPUT_DIR"
zip "../../../$ARCHIVE_NAME" femsq-*.jar
cd - > /dev/null

echo "Архив создан: $ARCHIVE_NAME"
```

## Важные замечания

1. **Версии должны совпадать:** Версии библиотек `femsq-*` должны точно соответствовать версии тонкого JAR
2. **Не удаляйте другие библиотеки:** В папке `lib/` находятся и другие библиотеки (Spring, JasperReports и т.д.) - их трогать не нужно
3. **Резервное копирование:** Перед обновлением рекомендуется сделать резервную копию папки `lib/`
4. **Только библиотеки femsq-*:** Обновлять нужно только библиотеки, начинающиеся с `femsq-`

## Устранение проблем

### Проблема: Предупреждения остаются после обновления

**Решение:**
1. Убедитесь, что версии библиотек точно совпадают с версией тонкого JAR
2. Проверьте, что старые версии библиотек удалены из папки `lib/`
3. Перезапустите приложение

### Проблема: Приложение не запускается после обновления

**Решение:**
1. Проверьте, что все библиотеки `femsq-*` скопированы корректно
2. Убедитесь, что файлы не повреждены (проверьте размеры)
3. Восстановите резервную копию папки `lib/` и попробуйте снова

## Связанные документы

- [Руководство по развёртыванию на Windows](windows-deployment-guide.md)
- [Руководство по обновлению библиотек](library-update-guide.md)
