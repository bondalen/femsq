# Правила ведения проектной документации FEMSQ

**Версия:** 2.0.0  
**Дата создания:** 2025-10-08  
**Последнее обновление:** 2025-10-09  
**Автор:** Александр  

## Обзор

Данный документ описывает структуру, правила и порядок ведения проектной документации для "Cистемы работы с контрагентами и объектами при капитальном строительстве на основе БД MS SQL Server" FEMSQ (Fish Eye MS SQL Server). Система предназначена для организации взаимодействия с контрагентами и дочерними организациями при капитальном строительстве.

## Связанные документы

- **[Справочник по системе ссылок](project-documentation-rules-reference.md)** - таблица форматов ссылок, примеры, правила формирования ID
- **[Система структурной нумерации](project-documentation-rules-structural-numbering.md)** - правила нумерации модулей, компонентов, классов
- **Правила отчётов JasperReports:** `code/femsq-backend/femsq-reports/src/main/resources/reports/embedded/REPORTING_RULES.md` (обязательно соблюдать при переносе/разработке отчётов)

## Структура документации

### 1. **project/project-docs.json** - Проектная документация
**Назначение:** Центральный файл с описанием архитектуры, технологий, модулей и конфигурации проекта.
**Содержание и правила ведения:** описаны в файле **project/project-docs-json-rules.md**.

### 2. **development/project-development.json** - Планирование разработки
**Назначение:** Файл планирования разработки в виде иерархической структуры задач с возможностью сворачивания ветвей.
**Содержание и правила ведения:** описаны в файле **development/project-development-json-rules.md**.

### 3. **journal/project-journal.json** - Дневник разработки
**Назначение:** Дневник разработки с детальным описанием выполненных работ, изменений и состояний.
**Содержание и правила ведения:** описаны в файле **journal/project-journal-json-rules.md**.


## Объекты разработки

### Кодовая база проекта
- Структура папок и файлов в папке **src** - соответствуе структуре определенной в разделе "Модули и их описание" в файле **project-docs.json**.

## Процесс добавления новых артефактов

### Обязательный чеклист при создании нового артефакта

#### При создании нового модуля, компонента или класса:

1. **Создать файл или папку артефакта** в соответствующей директории

2. **Добавить в project-docs.json:**
   - Найти соответствующий модуль в `project.modules.extensions`
   - Добавить артефакт в файл расширения (например, modules.json)
   - Указать: `id`, `number`, `name`, `artifact.location`, `responsibilities`, `dependsOn`, `status`
   - ID должен быть уникальным в пределах родительского элемента

3. **Создать задачу в project-development.json:**
   - **Добавить задачу** в `tasks.items` с новым ID (сквозная нумерация)
   - Указать `completionCriteria` вместо оценки времени
   - Добавить ссылку на артефакт в формате: `class:module.component.class`
   - **Обновить** `tasks.nextTaskId`

4. **Создать пункт структуры:**
   - Добавить `task-item` в соответствующее дерево (`structure.trees`)
   - Указать `structureId` с номером дерева (например, 01.01.01)
   - Указать `taskId` - ссылку на задачу
   - Обновить `displayName` с эмодзи статуса

5. **Добавить запись в project-journal.json:**
   - Создать лог о начале работы
   - Указать ссылки через иерархические пути:
     - `projectDocsRefs`: `["class:module.component.class"]`
     - `developmentTasks`: `["task:0004"]`

6. **Обновить зависимости:**
   - Если артефакт используется в других местах - добавить в `dependsOn`
   - Если задача нужна в нескольких деревьях - создать дополнительные пункты с тем же `taskId`

### Контроль целостности ссылок

При добавлении артефакта **ОБЯЗАТЕЛЬНО** проверить:
- ✅ Есть ли описание в `project-docs.json` (или расширениях modules.json)
- ✅ Есть ли задача в `project-development.json` → `tasks.items`
- ✅ Есть ли пункт структуры в `structure.trees` со ссылкой на задачу
- ✅ Есть ли запись в журнале `project-journal.json`
- ✅ Корректны ли все ссылки в формате `type:path`:
  - `projectDocsRefs`: `class:module.component.class`, `table:tableName`
  - `journalRefs`: `chat:chatId`, `log:logId`
  - `developmentTasks`: `task:taskId`
  - `aiRuleRefs`: `rule:ruleId`
- ✅ Указаны ли зависимости (`dependsOn` в project-docs.json)
- ✅ Синхронизированы ли статусы (задача и все её пункты имеют одинаковый статус в displayName)
- ✅ Обновлен ли `tasks.nextTaskId`
- ✅ Корректны ли структурные номера (начинаются с номера дерева)

## Связи между файлами

### Принципы связей

**Все связи выражаются через поле `links` с использованием иерархических путей:**

```json
{
  "links": {
    "projectDocsRefs": ["class:backend.config.Service", "table:users"],
    "journalRefs": ["chat:chat-2025-10-09-001", "log:log-2025-10-09-001"],
    "developmentTasks": ["task:0004", "task:0005"],
    "aiRuleRefs": ["rule:coding-standards"]
  }
}
```

**Формат ссылок:**
- `class:module.component.class` - артефакт кода
- `module:moduleId` - модуль проекта
- `component:module.component` - компонент
- `table:tableName` - таблица БД
- `task:taskId` - задача разработки
- `chat:chatId` или `log:logId` - запись журнала
- `rule:ruleId` - правило AI

### 1. **project-docs.json** → **project-development.json**

Задачи разработки ссылаются на артефакты проекта:

```json
// modules.json (расширение project-docs.json)
{
  "class": {
    "attributes": {
      "id": "DatabaseConfigService",
      "number": "01.01.01",
      "artifact": {
        "location": "com.femsq.database.config.DatabaseConfigService"
      }
    }
  }
}

// project-development.json
{
  "tasks": {
    "items": {
      "0004": {
        "task": {
          "task-attributes": {
            "links": {
              "projectDocsRefs": [
                "class:backend.database-config.DatabaseConfigService"
              ]
            }
          }
        }
      }
    }
  }
}
```

### 2. **project-development.json** → **project-journal.json**

Задачи ссылаются на записи журнала:

```json
// project-development.json
{
  "tasks": {
    "items": {
      "0004": {
        "task": {
          "task-attributes": {
            "links": {
              "journalRefs": [
                "chat:chat-2025-10-09-001",
                "log:log-2025-10-09-001"
              ]
            }
          }
        }
      }
    }
  }
}

// project-journal.json
{
  "sessions": [
    {
      "chat": {
        "chat-attributes": {
          "id": "chat-2025-10-09-001"
        }
      }
    }
  ]
}
```

### 3. **project-journal.json** → **project-development.json**

Записи журнала ссылаются на задачи:

```json
// project-journal.json
{
  "chat": {
    "chat-attributes": {
      "id": "chat-2025-10-09-001",
      "links": {
        "developmentTasks": [
          "task:0004",
          "task:0005"
        ]
      }
    }
  }
}
```

### 4. **project-journal.json** → **project-docs.json**

Записи журнала ссылаются на артефакты и таблицы:

```json
// project-journal.json
{
  "log": {
    "log-attributes": {
      "id": "log-2025-10-09-001",
      "links": {
        "projectDocsRefs": [
          "class:backend.database-config.DatabaseConfigService",
          "table:contractors"
        ]
      }
    }
  }
}
```

### Важно

**Внутренняя организация project-development.json** (деревья структуры с пунктами) - это НЕ связь между файлами, а механизм организации задач для навигации. При изменении статуса задачи он автоматически синхронизируется во всех пунктах структуры, где эта задача используется.

---

## Система ссылок через иерархические пути

### Формат ссылок

Все ссылки используют формат `type:path`, где путь строится из ID элементов через точку.

### Таблица форматов

| Тип | Формат | Пример |
|-----|--------|--------|
| Модуль | `module:id` | `module:backend` |
| Компонент | `component:module.component` | `component:backend.database-config` |
| Класс | `class:module.component.class` | `class:backend.database-config.DatabaseConfigService` |
| Вложенный класс | `class:module.component.class.nested` | `class:backend.config.Service.Validator` |
| Таблица БД | `table:name` | `table:contractors` |
| Задача | `task:id` | `task:0004` |
| Дерево | `tree:number` | `tree:01` |
| Пункт структуры | `item:tree.structure` | `item:01.01.01` |
| Чат | `chat:id` | `chat:chat-2025-10-09-001` |
| Лог | `log:id` | `log:log-2025-10-09-001` |
| Правило AI | `rule:id` | `rule:coding-standards` |

### Правила формирования ID

**Для модулей и компонентов:**
- Использовать kebab-case
- Краткие, но понятные
- Примеры: `backend`, `database-config`, `user-auth`

**Для классов:**
- PascalCase (как в коде)
- Полное имя класса
- Примеры: `DatabaseConfigService`, `ConnectionManager`, `UserRepository`

**Для таблиц:**
- snake_case (как в БД)
- Множественное число
- Примеры: `contractors`, `users`, `order_items`

### Преимущества

- ✅ **Устойчивость** - не зависит от порядка элементов в массивах
- ✅ **Уникальность** - путь через точку гарантирует уникальность
- ✅ **Читаемость** - понятна структура и местоположение
- ✅ **Соответствие коду** - похоже на пути пакетов Java
- ✅ **Гибкость** - можно ссылаться на любой уровень иерархии

## Правила обновления

### Обязательные требования
- **Перед любыми корректировками документации** - обязательно изучить и учесть правила ведения документации здесь и в файлах project/project-docs-json-rules.md, development/project-development-json-rules.md и journal/project-journal-json-rules.md
- **Перед созданием записей в журнале** - обязательно запросить имя чата у пользователя с предложением вариантов
- **При изменении структуры** - обновить соответствующие правила и связанные файлы

### Формат дат
- **ISO 8601:** YYYY-MM-DDTHH:mm:ssZ
- **Пример:** 2025-01-27T10:30:00Z

## Структура файлов документации

### Организация папок
```
docs/
├── project-documentation-rules.md  # Правила ведения документации
├── project/                        # Документация проекта
│   ├── project-docs.json          # Основной файл проекта
│   ├── architecture/              # Архитектурная документация
│   ├── decisions/                 # ADR решения
│   └── technical/                 # Техническая документация
├── development/                    # Документация разработки
│   ├── project-development.json   # Файл задач разработки
│   ├── tasks/                     # Описания задач
│   ├── technical/                 # Технические детали
│   └── notes/                     # Заметки по реализации
└── journal/                       # Журнал разработки
    ├── project-journal.json       # Файл журнала
    ├── actions/                   # Описания действий
    ├── technical/                 # Технические детали
    ├── notes/                     # Заметки по реализации
    └── troubleshooting/           # Решение проблем
```

### Принципы организации
- **Модульность** - каждый тип документации в своей папке
- **Самодостаточность** - каждая папка содержит все необходимые файлы
- **Навигация** - понятная структура для быстрого поиска
- **Расширяемость** - легко добавлять новые типы документации

## Инструменты и автоматизация

### Рекомендуемые инструменты
- **JSON Editor** - для редактирования JSON файлов
- **Git** - для версионирования изменений
- **Markdown Editor** - для ADR документации
- **Task Tracker** - для отслеживания прогресса

### Автоматизация
- **Валидация JSON** - проверка корректности структуры
- **Синхронизация ссылок** - проверка целостности связей
- **Генерация отчетов** - автоматическое создание отчетов
- **Уведомления** - оповещения об изменениях

## Контроль качества

### Проверки
- **Структурная целостность** - корректность JSON структуры
- **Ссылочная целостность** - существование всех ссылок
- **Временная согласованность** - логичность временных рамок
- **Зависимостная целостность** - корректность зависимостей

### Ревизии
- **Еженедельные** - проверка актуальности документации
- **Ежемесячные** - анализ полноты и качества
- **Квартальные** - пересмотр структуры и правил
- **По требованию** - при значительных изменениях

## Резервное копирование

### Стратегия бэкапов
- **Ежедневные** - автоматические бэкапы в Git
- **Еженедельные** - полные копии файлов
- **Перед изменениями** - создание снимков состояния
- **Внешние** - копирование в облачные хранилища

### Восстановление
- **Из Git** - восстановление из истории версий
- **Из бэкапов** - восстановление из резервных копий
- **Частичное** - восстановление отдельных разделов
- **Полное** - восстановление всей документации

## Заключение

Данная система документации обеспечивает:
- **Полноту** - охват всех аспектов проекта
- **Структурированность** - четкая организация информации
- **Трассируемость** - возможность отслеживания изменений
- **Масштабируемость** - возможность расширения системы
- **Удобство использования** - простота навигации и поиска
- **Поддержку разработки правил AI** - как объектов разработки
- **Правила для AI-ассистента** - четкие инструкции для работы с Cursor IDE

Соблюдение данных правил гарантирует качество и актуальность проектной документации на всех этапах разработки системы.

---

**Документ утвержден:** 2025-10-09  
**Следующий пересмотр:** 2026-01-09  
**Ответственный:** Александр
