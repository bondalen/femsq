VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
END
Attribute VB_Name = "cstAgPn"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Compare Database

' объект *Стройка-Агент-Код* 09.08.2022

' ###################################################################################################################################################
' область определения закрытых пременных, содержащих значения свойств ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
' !!! не нужно их писать в других местах, это приведет к ошибке. 07.07.2022
' ключ объекта #Стройка-Агент-Код#
Private mlngCstAgPnKey As Long
' база данных
Private mdbDb As DAO.Database
' область определения закрытых пременных, содержащих значения свойств ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
' ---------------------------------------------------------------------------------------------------------------------------------------------------
Const cstrTable As String = "ags_cstAgPn", cstrTableKeyField As String = "cstapKey"
' ---------------------------------------------------------------------------------------------------------------------------------------------------
' ###################################################################################################################################################


' ###################################################################################################################################################
' геттеры и сеттеры (леттеры) свойств

' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
' свойство *ключ объекта #Стройка-Агент-Код#*. 09.08.2022
' '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттер свойства *ключ объекта #Стройка-Агент-Код#*
Public Property Get lngCstAgPnKey() As Long
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
    lngCstAgPnKey = mlngCstAgPnKey
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' свойство *ключ объекта #Стройка-Агент-Код#*. 09.08.2022. Окончание
' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
' свойство *Код объекта #Стройка-Агент-Код#*. 09.08.2022
' '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттер свойства *Код объекта #Стройка-Агент-Код#*
Public Property Get strCode() As Variant
    Const cstrTitle As String = "Процедура *Геттер свойства *Код объекта #Стройка-Агент-Код#*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    strCode = readFieldVar("cstapIpgPnN")

NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle: Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' свойство *Код объекта #Стройка-Агент-Код#*. 09.08.2022. Окончание
' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
' свойство *Ключ объекта #Стройка-Агент#*. 09.08.2022
' '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттер свойства *Ключ объекта #Стройка-Агент#*
Public Property Get lngCstAgKey() As Long
    Const cstrTitle As String = "Процедура *Геттер свойства *Ключ объекта #Стройка-Агент#*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    lngCstAgKey = readFieldVar("cstapCsta")

NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle: Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' свойство *Ключ объекта #Стройка-Агент#*. 09.08.2022. Окончание
' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
' свойство *Стройка, наименование*. 09.08.2022
' '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттер свойства *Стройка, наименование*
Public Property Get strCstName() As Variant
    Const cstrTitle As String = "Процедура *Геттер свойства *Стройка, наименование*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    strCstName = readFieldVar("cstapCstName")

NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle: Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' свойство *Стройка, наименование*. 09.08.2022. Окончание
' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
' свойство *Стройка, наименование. Длина строки менее 256 символов*. 09.08.2022
' '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттер свойства *Стройка, наименование. Длина строки менее 256 символов*
Public Property Get strCstName255() As Variant
    Const cstrTitle As String = "Процедура *Геттер свойства *Стройка, наименование. Длина строки менее 256 символов*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    strCstName255 = readFieldVar("cstapCstName255")

NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle: Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' свойство *Стройка, наименование. Длина строки менее 256 символов*. 09.08.2022. Окончание
' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
' свойство *Стройка, наименование организации-заказчика*. 09.08.2022
' '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттер свойства *Стройка, наименование организации-заказчика*
Public Property Get strOgName() As Variant
    Const cstrTitle As String = "Процедура *Геттер свойства *Стройка, наименование организации-заказчика*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    strOgName = readFieldVar("cstapOgName")

NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle: Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' свойство *Стройка, наименование организации-заказчика*. 09.08.2022. Окончание
' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
' свойство родительский объект *Стройка агента*. 27.07.2023
' '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттер свойства *Стройка, наименование организации-заказчика*
Public Property Get parentCstAg() As cstAg
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
    Dim cstAgPr As cstAg
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
    Const cstrTitle As String = "Процедура *Геттер свойства #Родительский объект *Стройка агента*#*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    If lngCstAgKey > 0 And Not mdbDb Is Nothing Then
        Set cstAgPr = ClassFactory.cstAgByKey(lngCstAgKey, mdbDb)
    Else
        Set cstAgPr = Nothing
    End If
    
    Set parentCstAg = cstAgPr

NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle: Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' свойство родительский объект *Стройка агента*. 27.07.2023. Окончание
' +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
' геттеры и сеттеры (леттеры) свойств. Окончание
' ###################################################################################################################################################


' ###################################################################################################################################################
' инициализации и реинициализации
' ***************************************************************************************************************************************************
' обработка встроенного события инициализации
Private Sub Class_Initialize()
    ' инициализируем объект с нулевым ключём. В таком виде он не имеет смысла.
    ' Требуется реинициализация.
    ' -1 означает, что проверки наличия свойства не было. Если позже будет установлено значение свойства,
    ' то оно будет приведено к 0 при отсутствии и к значению при наличии.
    ' Это чтобы избежать необходимости каждый раз вычислять свойство заново
    mlngCstAgPnKey = -1
End Sub
' ***************************************************************************************************************************************************

' ***************************************************************************************************************************************************
' реинициализируем объект *Стройка-Агент-Код* по известному ключу такого объекта. 09.08.2022
' ...................................................................................................................................................
Public Sub ReinitialiseByKey(ByVal cstAgPnKey As Long, ByRef boResult As Boolean, ByRef db As DAO.Database)
    ' ...............................................................................................................................................
    Dim rs As DAO.Recordset, strSql As String
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
    Const cstrTitle As String = "Процедура *Реинициализируем объект #Стройка-Агент-Код# по известному ключу такого объекта*."
' ---------------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    ' ключ объекта равен -1? То есть реинициализация ранее не проводилась
    If mlngCstAgPnKey = -1 Then
        ' да,ключ объекта равен -1
        ' отыскиваем объект по известному ключу
        strSql = "SELECT * FROM " & cstrTable & " WHERE " & cstrTableKeyField & " = " & cstAgPnKey & ";"
        Set rs = db.OpenRecordset(strSql, dbOpenSnapshot)
        
        ' имеются ли записи с указанным ключём?
        If rs.RecordCount = 1 Then
            ' да, записи с указанным ключём имеются
            mlngCstAgPnKey = cstAgPnKey
            Set mdbDb = db ' устанавливаем ссылку на базу данных
            boResult = True ' результат положительный
        Else
            ' нет, записи с указанным ключём отсутствуют
            mlngCstAgPnKey = 0
            boResult = False ' результат отрицательный
        End If
        
        ' закрываем набор записей
        rs.Close: Set rs = Nothing
    Else
        ' да,ключ объекта не равен -1
        ' ключ объекта равен 0?
        If mlngCstAgPnKey = 0 Then
            ' да, ключ объекта равен 0. Ранее он безуспешно реинициализировался
            boResult = False
        Else
            ' нет, ключ объекта не равен 0. Ранее он успешно реинициализировался
            boResult = True
        End If
    End If
    
NormalExit:
    Exit Sub
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle: Resume NormalExit
End Sub
' реинициализируем объект *Стройка-Агент-Код* по известному ключу такого объекта. 09.08.2022. Окончание
' ***************************************************************************************************************************************************

' ***************************************************************************************************************************************************
' реинициализируем объект *Стройка-Агент-Код* по известному коду такого объекта. 19.09.2022
' ...................................................................................................................................................
Public Sub ReinitialiseByCode(ByVal cstAgPnCode As String, ByRef boResult As Boolean, ByRef db As DAO.Database)
    ' ...............................................................................................................................................
    Dim rs As DAO.Recordset, strSql As String
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
    Const cstrTitle As String = "Процедура *Реинициализируем объект #Стройка-Агент-Код# по известному коду такого объекта*."
' ---------------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    ' ключ объекта равен -1? То есть реинициализация ранее не проводилась
    If mlngCstAgPnKey = -1 Then
        ' да,ключ объекта равен -1
        ' отыскиваем объект по известному ключу
        strSql = "SELECT * FROM " & cstrTable & " WHERE cstapIpgPnN = """ & cstAgPnCode & """;"
        Set rs = db.OpenRecordset(strSql, dbOpenSnapshot)
        
        ' имеются ли записи с указанным ключём?
        If rs.RecordCount = 1 Then
            ' да, записи с указанным ключём имеются
            mlngCstAgPnKey = rs!cstapKey
            Set mdbDb = db ' устанавливаем ссылку на базу данных
            boResult = True ' результат положительный
        Else
            ' нет, записи с указанным ключём отсутствуют
            mlngCstAgPnKey = 0
            boResult = False ' результат отрицательный
        End If
    Else
        ' да,ключ объекта не равен -1
        ' ключ объекта равен 0?
        If mlngCstAgPnKey = 0 Then
            ' да, ключ объекта равен 0. Ранее он безуспешно реинициализировался
            boResult = False
        Else
            ' нет, ключ объекта не равен 0. Ранее он успешно реинициализировался
            boResult = True
        End If
    End If
    
    ' закрываем набор записей
    rs.Close: Set rs = Nothing
    
NormalExit:
    Exit Sub
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle: Resume NormalExit
End Sub
' реинициализируем объект *Стройка-Агент-Код* по известному коду такого объекта. 19.09.2022. Окончание
' ***************************************************************************************************************************************************

' ***************************************************************************************************************************************************
' реинициализируем объект *Стройка-Агент-Код* созданием нового, а так же новых *Стройки* и *Стройки агента* по имени и коду. 26.07.2023
' '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
Public Sub riCstAgPnByNameAndCodeNew(ByVal strCstName As String, ByVal strCstAgPn As String, ByRef boResult As Boolean, ByRef db As DAO.Database)
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
    Dim cstAgNew As cstAg
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
    Const cstrTitle As String = _
    "Процедура *Реинициализируем объект #Стройка-Агент-Код# созданием нового, а так же новых #Стройки# и #Стройки агента# по имени и коду*"
' ---------------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler
' ---------------------------------------------------------------------------------------------------------------------------------------------------
    
    ' ключ объекта равен -1? То есть реинициализация ранее не проводилась
    If mlngCstAgPnKey = -1 Then
        ' да,ключ объекта равен -1
        ' отыскиваем объект по известному ключу
        
        Set cstAgNew = ClassFactory.cstAgByNameAndAgent(strCstName, Left(strCstAgPn, 3), db)
        If Not cstAgNew Is Nothing Then
            Set rs = db.OpenRecordset(cstrTable, dbOpenDynaset, dbSeeChanges)
            ' заготавливаем создаваемую строку
            rs.AddNew
                rs.Fields("cstapCsta").value = cstAgNew.cstAgKey
                rs.Fields("cstapIpgPnN").value = strCstAgPn
            ' вносим создаваемую строку в базу данных
            rs.Update
            rs.Bookmark = rs.LastModified
            mlngCstAgPnKey = rs.Fields(cstrTableKeyField).value
            Set mdbDb = db
            boResult = True ' результат положительный
            ' закрываем набор записей
            rs.Close: Set rs = Nothing
        Else
            mlngCstAgPnKey = 0
            boResult = False
        End If
        
    Else
        ' да,ключ объекта не равен -1
        ' ключ объекта равен 0?
        If mlngCstAgPnKey = 0 Then
            ' да, ключ объекта равен 0. Ранее он безуспешно реинициализировался
            boResult = False
        Else
            ' нет, ключ объекта не равен 0. Ранее он успешно реинициализировался
            boResult = True
        End If
    End If
    
'    ' закрываем набор записей
'    rs.Close: Set rs = Nothing

' ---------------------------------------------------------------------------------------------------------------------------------------------------
NormalExit:
    Exit Sub
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle
    Resume NormalExit
' ---------------------------------------------------------------------------------------------------------------------------------------------------
End Sub
' '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' реинициализируем объект *Стройка-Агент-Код* созданием нового, а так же новых *Стройки* и *Стройки агента* по имени и коду. 26.07.2023. Окончание
' ***************************************************************************************************************************************************

' инициализации и реинициализации. Окончание
' ###################################################################################################################################################

' ###################################################################################################################################################
' чтение полей и запись в них
' ***************************************************************************************************************************************************
' редактируем строковое поле. 09.08.2022
Private Sub editFieldStr(ByVal strFieldName As String, ByVal strNew As Variant)

    ClassFunc.varEditFieldStr strFieldName, strNew, cstrTable, mlngCstAgPnKey, cstrTableKeyField, mdbDb
    
End Sub
' редактируем строковое поле. 09.08.2022. Окончание
' ***************************************************************************************************************************************************

' ***************************************************************************************************************************************************
' читаем значение поля в переменную типа Variant. 09.08.2022
Private Function readFieldVar(ByVal dateFieldName As String) As Variant
    
    readFieldVar = ClassFunc.varReadField(dateFieldName, cstrTable, mlngCstAgPnKey, cstrTableKeyField, mdbDb)
    
End Function
' читаем значение поля в переменную типа Variant. 09.08.2022. Окончание
' ***************************************************************************************************************************************************

' ***************************************************************************************************************************************************
' редактируем поле даты. 09.08.2022
Private Sub editFieldDate(ByVal dateFieldName As String, ByVal dateNew As Variant)
    
    ClassFunc.varEditFieldDate dateFieldName, dateNew, cstrTable, mlngCstAgPnKey, cstrTableKeyField, mdbDb
    
End Sub
' редактируем поле даты. 09.08.2022. Окончание
' ***************************************************************************************************************************************************

' ***************************************************************************************************************************************************
' редактируем числовое поле. 09.08.2022
Private Sub editFieldNum(ByVal numFieldName As String, ByVal numNew As Variant)
    
    ClassFunc.varEditFieldNum numFieldName, numNew, cstrTable, mlngCstAgPnKey, cstrTableKeyField, mdbDb
    
End Sub
' редактируем числовое поле. 09.08.2022. Окончание
' ***************************************************************************************************************************************************
' чтение полей и запись в них. Окончание
' ###################################################################################################################################################

