VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
END
Attribute VB_Name = "rcSm"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Compare Database

' объект *Сумма изменения отчёта агента* 22.07.2022

' ###################################################################################################################################################
' область определения закрытых пременных, содержащих значения свойств ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
' !!! не нужно их писать в других местах, это приведет к ошибке. 07.07.2022
' ключ объекта #Сумма изменения отчёта агента#
Private mlngRсSmKey As Long
' база данных
Private mdbDb As DAO.Database
' область определения закрытых пременных, содержащих значения свойств ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
' ###################################################################################################################################################

' ###################################################################################################################################################
' геттеры и сеттеры (леттеры) свойств
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттер свойства *всего*. 20.07.2022
Public Property Get curRcSmTtl() As Variant
    Const cstrTitle As String = "Процедура *Геттер свойства *всего*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    curRcSmTtl = readFieldVar("raсs_total")
    
NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle
    Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' леттер свойства *всего*. 20.07.2022
Public Property Let curRcSmTtl(ByVal curRcSmTtlNew As Variant)
    Const cstrTitle As String = "Процедура *Леттер свойства *всего*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    editFieldNum "raсs_total", curRcSmTtlNew
    
NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle
    Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттер свойства *СМР*. 20.07.2022
Public Property Get curRcSmWork() As Variant
    Const cstrTitle As String = "Процедура *Геттер свойства *СМР*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    curRcSmWork = readFieldVar("raсs_work")
    
NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle
    Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' леттер свойства *СМР*. 20.07.2022
Public Property Let curRcSmWork(ByVal curRcSmWorkNew As Variant)
    Const cstrTitle As String = "Процедура *Леттер свойства *СМР*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    editFieldNum "raсs_work", curRcSmWorkNew
    
NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle
    Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттер свойства *Оборудование*. 20.07.2022
Public Property Get curRcSmEquip() As Variant
    Const cstrTitle As String = "Процедура *Геттер свойства *Оборудование*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    curRcSmEquip = readFieldVar("raсs_equip")
    
NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle
    Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' леттер свойства *Оборудование*. 20.07.2022
Public Property Let curRcSmEquip(ByVal curRcSmEquipNew As Variant)
    Const cstrTitle As String = "Процедура *Леттер свойства *Оборудование*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    editFieldNum "raсs_equip", curRcSmEquipNew
    
NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle
    Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттер свойства *Прочие*. 20.07.2022
Public Property Get curRcSmOthers() As Variant
    Const cstrTitle As String = "Процедура *Геттер свойства *Прочие*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    curRcSmOthers = readFieldVar("raсs_others")
    
NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle
    Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' леттер свойства *Прочие*. 20.07.2022
Public Property Let curRcSmOthers(ByVal curRcSmOthersNew As Variant)
    Const cstrTitle As String = "Процедура *Леттер свойства *Прочие*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    editFieldNum "raсs_others", curRcSmOthersNew
    
NormalExit:
    Exit Property
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle
    Resume NormalExit
End Property ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' геттеры и сеттеры (леттеры) свойств. Окончание
' ###################################################################################################################################################


' ###################################################################################################################################################
' инициализации и реинициализации
' ***************************************************************************************************************************************************
' обработка встроенного события инициализации
Private Sub Class_Initialize()
    ' инициализируем объект с нулевым ключём. В таком виде он не имеет смысла.
    ' Требуется реинициализация.
    ' -1 означает, что проверки наличия свойства не было. Если позже будет установлено значение свойства,
    ' то оно будет приведено к 0 при отсутствии и к значению при наличии.
    ' Это чтобы избежать необходимости каждый раз вычислять свойство заново
    mlngRсSmKey = -1
End Sub
' ***************************************************************************************************************************************************


' ***************************************************************************************************************************************************
' реинициализируем объект *Сумма изменения отчёта агента* по известному ключу такого объекта. 22.07.2022
' ...................................................................................................................................................
Public Sub Class_ReinitialiseByKey(ByVal rсSmKey As Long, ByRef boResult As Boolean, db As DAO.Database)
    ' ...............................................................................................................................................
    Dim rs As DAO.Recordset, strSql As String
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
    Const cstrTitle As String = "Процедура *Реинициализируем объект *Сумма изменения отчёта агента* по известному ключу такого объекта*."
' ---------------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    ' ключ объекта равен -1? То есть реинициализация ранее не проводилась
    If mlngRсSmKey = -1 Then
        ' да,ключ объекта равен -1
        ' отыскиваем объект по известному ключу
        strSql = "SELECT * FROM ags_ra_change_summ WHERE raсs_key = " & rсSmKey & ";"
        Set rs = db.OpenRecordset(strSql, dbOpenSnapshot)
        
        ' имеются ли записи с указанным ключём?
        If rs.RecordCount = 1 Then
            ' да, записи с указанным ключём имеются
            mlngRсSmKey = rсSmKey
            Set mdbDb = db ' устанавливаем ссылку на базу данных
            boResult = True ' результат положительный
        Else
            ' нет, записи с указанным ключём отсутствуют
            mlngRсSmKey = 0
            boResult = False ' результат отрицательный
        End If
    Else
        ' да,ключ объекта не равен -1
        ' ключ объекта равен 0?
        If mlngRсSmKey = 0 Then
            ' да, ключ объекта равен 0. Ранее он безуспешно реинициализировался
            boResult = False
        Else
            ' нет, ключ объекта не равен 0. Ранее он успешно реинициализировался
            boResult = True
        End If
    End If
    
    ' закрываем набор записей
    rs.Close: Set rs = Nothing
    
NormalExit:
    Exit Sub
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle: Resume NormalExit
End Sub
' реинициализируем объект *Сумма изменения отчёта агента* по известному ключу такого объекта. 22.07.2022. Окончание
' ***************************************************************************************************************************************************

' ***************************************************************************************************************************************************
' реинициализируем объект *Сумма изменения отчёта агента* путём создания такого объекта. 22.07.2022
Public Sub Class_ReinitialiseCreateNew(ByVal rcKey As Long, ByRef boResult As Boolean, db As DAO.Database, _
    ByVal varTtl As Variant, ByVal varWork As Variant, ByVal varEquip As Variant, ByVal varOthers As Variant)
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
    Dim rs As DAO.Recordset, strSql As String, rcSmKeyNew As Long
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
    Const cstrTitle As String = "Процедура *Реинициализируем объект *Сумма изменения отчёта агента* путём создания такого объекта*."
    ' -----------------------------------------------------------------------------------------------------------------------------------------------
On Error GoTo ErrHandler

    rcSmKeyNew = 0

    ' ключ объекта равен -1? То есть реинициализация ранее не проводилась
    If mlngRсSmKey = -1 Then
        ' да,ключ объекта равен -1
        ' создаём новый объект
        Set rs = db.OpenRecordset("ags_ra_change_summ", dbOpenDynaset, dbFailOnError + dbSeeChanges)
        With rs
            .AddNew
                !raсs_raс = rcKey
            .Update
            .Bookmark = .LastModified
            rcSmKeyNew = !raсs_key
        End With
        ' имеется ли новый ключ?
        If rcSmKeyNew > 0 Then
            ' да, новый ключ имеется
            mlngRсSmKey = rcSmKeyNew
            
            ' устанавливаем ссылку на базу данных
            Set mdbDb = db
            
            ' записываем суммы
            If IsNull(varTtl) Or IsNumeric(varTtl) Then
                Me.curRcSmTtl = varTtl
            End If
            If IsNull(varWork) Or IsNumeric(varWork) Then
                Me.curRcSmWork = varWork
            End If
            If IsNull(varEquip) Or IsNumeric(varEquip) Then
                Me.curRcSmEquip = varEquip
            End If
            If IsNull(varOthers) Or IsNumeric(varOthers) Then
                Me.curRcSmOthers = varOthers
            End If
            
            ' результат положительный
            boResult = True
        Else
            ' нет, записи с указанным ключём отсутствуют
            mlngRсSmKey = 0
            ' результат отрицательный
            boResult = False
        End If
        ' закрываем набор записей
        rs.Close: Set rs = Nothing
    Else
        ' да,ключ объекта не равен -1
        ' ключ объекта равен 0?
        If mlngRсSmKey = 0 Then
            ' да, ключ объекта равен 0. Ранее он безуспешно реинициализировался
            boResult = False
        Else
            ' нет, ключ объекта не равен 0. Ранее он успешно реинициализировался
            boResult = True
        End If
    End If
    
    
NormalExit:
    Exit Sub
ErrHandler:
    MsgBox Err.Description & vbCrLf & "Error number: " & Err.Number & vbCrLf & cstrTitle, vbExclamation, cstrTitle: Resume NormalExit
End Sub
' реинициализируем объект *Сумма изменения отчёта агента* путём создания такого объекта. 22.07.2022. Окончание
' ***************************************************************************************************************************************************



' инициализации и реинициализации. Окончание
' ###################################################################################################################################################


' ###################################################################################################################################################
' чтение полей и запись в них
' ***************************************************************************************************************************************************
' читаем значение поля в переменную типа Variant. 22.07.2022
Private Function readFieldVar(ByVal dateFieldName As String) As Variant
    
    readFieldVar = ClassFunc.varReadField(dateFieldName, "ags_ra_change_summ", mlngRсSmKey, "raсs_key", mdbDb)
    
End Function
' читаем значение поля в переменную типа Variant. 22.07.2022. Окончание
' ***************************************************************************************************************************************************

' ***************************************************************************************************************************************************
' редактируем числовое поле. 22.07.2022
Private Sub editFieldNum(ByVal numFieldName As String, ByVal numNew As Variant)
    
    ClassFunc.varEditFieldNum numFieldName, numNew, "ags_ra_change_summ", mlngRсSmKey, "raсs_key", mdbDb
    
End Sub
' редактируем числовое поле. 22.07.2022. Окончание
' ***************************************************************************************************************************************************
' чтение полей и запись в них. Окончание
' ###################################################################################################################################################

