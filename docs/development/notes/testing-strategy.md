# Стратегия тестирования FEMSQ

**Дата создания:** 2025-11-13  
**Автор:** Александр  
**Статус:** Предложение

## Текущее состояние

### Типы тестов

1. **Unit-тесты** (`*Test.java`)
   - Быстрые тесты без внешних зависимостей
   - Используют моки
   - Запускаются при `mvn test`

2. **Integration-тесты** (`*IT.java`, `*IntegrationTest.java`)
   - Требуют реальную БД MS SQL Server
   - Требуют переменные окружения `FEMSQ_DB_*`
   - Запускаются через профиль `integration`

3. **E2E-тесты** (Playwright)
   - Требуют запущенный backend
   - Требуют установленный Playwright
   - Запускаются через `npm run test:e2e`

### Проблемы текущей системы

1. ❌ Нет единой конфигурации для всех модулей
2. ❌ Integration-тесты не запускаются автоматически
3. ❌ Нет CI/CD конфигурации
4. ❌ Нет четкого разделения по категориям тестов
5. ❌ Нет автоматической проверки перед коммитом
6. ❌ Нет отчетов о покрытии кода

## Предлагаемая структура

### 1. Maven профили для разных сценариев

#### Профиль `unit` (по умолчанию)
- Запускает только unit-тесты
- Быстрый запуск (< 1 минуты)
- Не требует БД

#### Профиль `integration`
- Запускает integration-тесты
- Требует переменные `FEMSQ_DB_*`
- Средняя скорость (1-5 минут)

#### Профиль `all-tests`
- Запускает unit + integration тесты
- Полная проверка кода

#### Профиль `ci`
- Для CI/CD окружения
- Все тесты + отчеты о покрытии
- Проверка качества кода

### 2. Организация тестов по категориям

Использовать JUnit 5 теги для категоризации:

- `@Tag("unit")` - unit-тесты
- `@Tag("integration")` - integration-тесты
- `@Tag("database")` - тесты, требующие БД
- `@Tag("slow")` - медленные тесты (> 1 секунды)
- `@Tag("fast")` - быстрые тесты (< 1 секунды)

### 3. CI/CD конфигурация

GitHub Actions workflow для автоматического запуска тестов:
- При каждом PR: unit-тесты
- При merge в main: все тесты
- Ночные сборки: полный набор тестов + E2E

### 4. Скрипты для разработчиков

Создать скрипты для удобного запуска:
- `test-unit.sh` - только unit-тесты
- `test-integration.sh` - только integration-тесты
- `test-all.sh` - все тесты
- `test-e2e.sh` - E2E тесты

### 5. Pre-commit hooks

Автоматический запуск unit-тестов перед коммитом (опционально)

## Время запуска тестов

### При разработке (локально)
- **Unit-тесты**: автоматически при `mvn test` (быстро)
- **Integration-тесты**: вручную при необходимости (`mvn verify -Pintegration`)

### При создании PR
- **Unit-тесты**: автоматически в CI
- **Integration-тесты**: опционально (если изменен код, связанный с БД)

### При merge в main
- **Все тесты**: автоматически в CI
- **E2E-тесты**: автоматически в CI

### Ночные сборки
- **Полный набор**: все тесты + отчеты + проверка качества

## Рекомендации по реализации

1. ✅ Унифицировать конфигурацию Maven во всех модулях
2. ✅ Добавить теги JUnit 5 для категоризации
3. ✅ Создать GitHub Actions workflow
4. ✅ Создать скрипты для запуска тестов
5. ✅ Добавить отчеты о покрытии кода (JaCoCo)
6. ✅ Документировать процесс тестирования


