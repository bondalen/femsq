**Дата:** 2025-11-11  
**Автор:** Александр  
**Этап:** 02.1.2

### UX-сценарий модальной формы подключения к БД
**Цели**: предоставить пользователю последовательный способ ввода реквизитов подключения, проверить данные до установления соединения, сообщить результат и обновить глобальный статус приложения.

**Точка входа**
- Кнопка `Подключение к БД` в верхней панели каркаса. Активна в любом состоянии.
- Дополнительный триггер из строки состояния (ссылка «Подключиться») в состоянии `idle`.

**Структура модального окна**
1. Заголовок «Подключение к базе данных» + иконка статуса.
2. Блок полей ввода:
   - `host` (строка, обязательное)
   - `port` (число, обязательное, маска для ввода)
   - `database` (строка, обязательное)
   - `schema` (строка, опциональное, отображается после выбора режима)
   - `authMode` (переключатель: SQL Auth / Windows Auth / Token)
   - `username` (строка, обязательное для SQL Auth)
   - `password` (строка, пароль, обязательное для SQL Auth, скрыто по умолчанию)
   - `token` (textarea, обязательное для Token Mode)
3. Блок «Дополнительно» (collapsible): параметры таймаута, SSL, имя приложения.
4. Подвал с действиями: кнопки `Подключить`, `Отмена`, и вспомогательная `Сбросить` (возвращает к последним сохранённым значениям).
5. Информационная панель статуса под формой (toast внутри модалки) — информирует о прогрессе или ошибках.

**Навигация по режимам аутентификации**
- Переключение `authMode` динамически показывает релевантные поля и скрывает несвязанные, сохраняя их заполненные значения в state.
- Tooltip на переключателе поясняет, когда доступен каждый режим.

**Валидация и подсказки**
- Inline-валидация при расфокусе поля; кнопка `Подключить` доступна только при валидной форме.
- Дополнительные подсказки (`?` иконка) описывают формат хоста, допустимые значения порта.
- При ошибке поле подсвечивается красным, сообщение отображается под полем, также дублируется в статусной панели.

**Порядок действий пользователя**
1. Открытие модалки → форма в состоянии `idle`, заполнена последними сохранёнными данными.
2. Пользователь корректирует значения и нажимает `Подключить`.
3. Форма блокируется, показывается индикатор (`connecting`).
4. После ответа backend обновляются глобальные состояния.
5. При успешном подключении модалка закрывается, верхняя панель и строка состояния обновляются (`connected`).
6. При ошибке форма разблокируется, статус показывает сообщение и варианты `Повторить` / `Подробнее`.

**Состояния модальной формы**
- `idle`: форма доступна, кнопка `Подключить` активна при валидных данных.
- `validating`: локальная проверка, короткий спиннер на кнопке.
- `connecting`: затенение полей, отображение прогресса «Подключение…»; кнопка `Отмена` превращается в `Прервать`.
- `success`: вспышка зеленого статуса, закрытие через 500 мс, глобальное событие `connection:success`.
- `error`: красный статус, форма разблокирована, кнопка `Подключить` снова доступна.
- `closing`: модалка плавно скрывается, сбрасывает временные данные.

**Ошибки и уведомления**
- Для сетевых ошибок отображается текст «Не удалось подключиться к серверу» + кнопка «Повторить».
- Для ошибок валидации backend поля подсвечиваются с текстом из ответа.
- Ссылки `Скопировать лог` и `Подробнее` открывают страницу с диагностикой в отдельном окне.

**Интеграция с глобальным каркасом**
- При `connecting` верхняя панель показывает спиннер; строка состояния отображает «Подключение…».
- После `success` обновляются сохранённые параметры в локальном хранилище, кнопка `Организации` активируется.
- Событие `connection:disconnect` сбрасывает форму на сохранённые значения и очищает пароль.

**UX-подсказки**
- Кнопка `Сбросить` недоступна, если введённые значения совпадают с сохранёнными.
- При закрытии по `Esc` всплывает подтверждение, если есть несохранённые изменения.
- На мобильных устройствах модалка разворачивается на всю высоту, подвал фиксируется поверх клавиатуры.
