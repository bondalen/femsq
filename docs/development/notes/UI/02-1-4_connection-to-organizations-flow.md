**Дата:** 2025-11-11  
**Автор:** Александр  
**Этап:** 02.1.4

### UX-сценарии «подключение → просмотр организаций»
**Цели**: описать последовательность действий пользователя от запуска приложения до просмотра деталей организаций, учитывая возможные развилки и ошибки.

**Сценарий A. Первое подключение и успешный просмотр**
1. Пользователь открывает приложение → верхняя панель и строка состояния в режиме `idle`.
2. Нажимает `Подключение к БД` → открывается модалка (состояние `idle`, данные пусты или шаблонные).
3. Пользователь заполняет форму (host, port, database, authMode=SQL, username, password) → inline-валидация подтверждает корректность.
4. Нажимает `Подключить`:
   - Форма переходит в `connecting`; верхняя панель показывает спиннер, строка состояния «Подключение…».
5. Backend подтверждает соединение → модалка переходит в `success`, закрывается, глобальное состояние `connected`.
6. Кнопка `Организации` подсвечивается, пользователь нажимает её.
7. Экран «Организации» загружается, состояние `loading`, таблица мутная.
8. После получения данных статус меняется на `ready`: таблица отображает организации, карточка пустая.
9. Пользователь выбирает организацию → карточка заполняется, agents-запрос выполняется асинхронно (состояние `selectionLoading` → `ready`).
10. Строка состояния отображает «Подключено к schemaX • 120 организаций».

**Сценарий B. Ошибка подключения и повторная попытка**
1. Шаги 1–4 аналогичны сценарию A.
2. Backend возвращает ошибку (например, неверный пароль) → модалка в состоянии `error`, под паролем подсветка «Неверные учетные данные».
3. Пользователь исправляет пароль, нажимает `Подключить` повторно → `connecting` → успешный ответ → возвращаемся на шаг 5 сценария A.
4. Приложение фиксирует ошибку в логах, предлагает ссылку «Скопировать лог».

**Сценарий C. Смена подключений и сброс фильтров**
1. Пользователь уже находится на экране «Организации» со списком.
2. Нажимает на нижнюю строку состояния «Отключиться» → глобальное состояние `disconnecting`, таблица сереет.
3. После успешного отключения статус `idle`, кнопка `Организации` отключена.
4. Пользователь снова нажимает `Подключение к БД`, использует сохранённые параметры (кнопка `Сбросить`).
5. Подключение проходит успешно, пользователь возвращается на экран «Организации»; фильтры сбрасываются, показывается уведомление «Фильтры сброшены после нового подключения».

**Сценарий D. Отказ от подключения**
1. Пользователь открывает модалку подключения, вводит неполные данные.
2. Получает предупреждение при попытке закрыть модалку (`Esc` или крестик): диалог подтверждает, что не все изменения сохранены.
3. Пользователь выбирает `Отмена` → остаётся в модалке и завершает ввод / нажимает `Отмена` в модалке → возвращается на экран с подсказкой «Подключение требуется для просмотра данных».

**Состояния и события интеграции**
- `connection:success` → активирует переход на экран «Организации», инициирует начальную загрузку.
- `connection:error` → отображает toast с текстом ошибки, позволяет повторить попытку.
- `organizations:load:start` → строка состояния «Загрузка организаций…».
- `organizations:load:success` → обновляет счётчик и отображает время обновления.
- `organizations:load:error` → показывает alert и блокирует действия до повторной попытки.

**UX-подсказки**
- После успешного подключения отображается brief «Вы можете открыть Organizations позже из верхнего меню».
- При зависимости от фильтров появляется toast «Выбранные фильтры применены».
- Все сценарии документированы для регрессионных тестов UX (checklist).