**Дата:** 2025-11-16  
**Автор:** Александр  
**Связанные задачи:** task:0024 (completed)
**Связанное предложение:** [chat-resume-25-1115.md](../chat-resume/chat-resume-25-1115.md)

## Контекст
- Цель на сегодня: ручное тестирование единого артефакта (fat JAR) через браузер, запущенного в WSL Ubuntu, с доступом из Windows.
- Текущая машина: `workstation-wsl-ubuntu` (User-PC, Ubuntu 24.04 LTS, WSL2). Docker MSSQL контейнер `vuege-mssql` работает, но имеет статус `unhealthy`; порт 1433 доступен.
- Конфигурация DBHub присутствует в `.cursor/mcp.json` и локально установлена в `.cursor/dbhub`.
- Frontend встроен в JAR, ожидаемый доступ: `http://localhost:8080`.

## Структурный план (№ 03)

- ⏳ 03.0 Этап 1 ― Подготовка окружения для ручного тестирования JAR
  - ✅ 03.1 Проверить и зафиксировать окружение
    - ✅ 03.1.1 Java 21 и Maven 3.9+ в WSL (`java -version`, `mvn -v`) — Java 21.0.8 LTS, Maven 3.8.7
    - ✅ 03.1.2 Порт 8080 свободен в WSL (`ss -ltnp | grep :8080`) — свободен
    - ✅ 03.1.3 MSSQL Docker контейнер `vuege-mssql` доступен (`docker ps`, `docker logs` при необходимости) — Up (unhealthy)
    - ✅ 03.1.4 Проверить доступность порта 1433 из WSL (`/dev/tcp/localhost/1433`) — доступен
  - ✅ 03.2 Сборка единого JAR
    - ✅ 03.2.1 Выполнить `mvn clean package -DskipTests` в `/home/alex/femsq/code` — BUILD SUCCESS
    - ✅ 03.2.2 Убедиться в наличии артефакта `code/femsq-backend/femsq-web/target/femsq-web-0.1.0-SNAPSHOT.jar`
  - ✅ 03.3 Настройка параметров подключения к БД
    - ✅ 03.3.1 Подготовлен файл окружения `/home/alex/femsq/code/config/env/femsq-db.env` и скрипт экспорта `/home/alex/femsq/code/scripts/export-femsq-db.sh`
    - ✅ 03.3.2 Инструкция: для ручной настройки можно использовать `/setup` в UI
  - ✅ 03.4 Запуск приложения
    - ✅ 03.4.1 Запущено в фоне: `java -jar code/femsq-backend/femsq-web/target/femsq-web-0.1.0-SNAPSHOT.jar`, лог: `target/app.log`
    - ✅ 03.4.2 Проверка: SPA доступен по `/`, GraphQL отвечает на POST `/graphql` (`{ "data": { "__typename": "Query" } }`). Прямой `/actuator/*` перехватывается SPA-маршрутом (404) — проверка доступности выполнена через UI и GraphQL.

- ✅ 03.5 Этап 2 ― Smoke-тест UI и API через браузер Windows
  - ✅ 03.5.1 Доступ к `http://localhost:8080/` — SPA отдается (HTML)
  - ✅ 03.5.2 `/setup` доступен (страница отдается)
  - ✅ 03.5.3 Маршрутизация SPA: прямой переход на `/organizations` возвращает SPA (подтверждение F5)
  - ✅ 03.5.4 REST `GET /api/v1/organizations` — 503 (ожидаемо без валидной конфигурации/доступа к БД)
  - ✅ 03.5.5 GraphQL POST `/graphql` с `{ organizations { ogKey ogName } }` — INTERNAL_ERROR (ожидаемо без валидной конфигурации/данных)
  - ✅ 03.5.6 Проверка DevTools (CORS/404 статика/JS) — до сохранения конфигурации были ожидаемые 404 на `/connection/config`; после сохранения — без критичных ошибок

- ✅ 03.6 Этап 3 ― Наблюдаемость и устойчивость
  - ✅ 03.6.1 Логи: ошибок ERROR после успешного подключения нет; зафиксированы ожидаемые ошибки при неверной БД (FishEye) до исправления
  - ✅ 03.6.2 Функциональные пинги вместо `/actuator`: REST и GraphQL стабильно отвечают (3,0,10; organizations { ogKey ogName })
  - ✅ 03.6.3 Недоступность БД: при `docker stop vuege-mssql` REST вернул 500; после запуска контейнера и готовности порта 1433 — восстановление без ручного вмешательства, REST снова 3,0,10
  - ✅ 03.6.4 Перезапуск приложения: настройки сохранились, после старта сразу доступен список организаций

- ✅ 03.7 Этап 4 ― Документация и фиксация результатов
  - ✅ 03.7.1 Обновлён `docs/journal/project-journal.json`: добавлен chat-2025-11-16-001 и log-2025-11-16-001; lastUpdated=2025-11-16
  - ✅ 03.7.2 Обновлён `docs/development/project-development.json`: добавлена задача task:0024 (completed), nextTaskId=0025; lastUpdated=2025-11-16
  - ✅ 03.7.3 Зафиксирован риск: контейнер MSSQL unhealthy (рекомендация проверить healthcheck/логи)

## Контрольные точки
- K5.1 ― JAR успешно собирается и запускается, `/actuator/health` — UP
- K5.2 ― `/setup` сохраняет конфигурацию, приложение подключается к MSSQL
- K5.3 ― Основные UI-потоки и API (REST/GraphQL) работают стабильно
- K5.4 ― Нет 404 по статикам/SPA маршрутам при прямых переходах и F5
- K5.5 ― В логах отсутствуют ошибки уровня ERROR во время сценариев

## Статус плана
- ✅ **Этап 1 (03.0)** — выполнен 2025-11-16
- ✅ **Этап 2 (03.5)** — выполнен 2025-11-16
- ✅ **Этап 3 (03.6)** — выполнен 2025-11-16
- ✅ **Этап 4 (03.7)** — выполнен 2025-11-16

## Предложения и риски
- **Контейнер MSSQL unhealthy**: перед началом smoke рекомендую проверить `docker logs vuege-mssql`, healthcheck, стартовые скрипты и время инициализации. При необходимости временно ослабить healthcheck или увеличить таймаут.
- **GraphQL в IT нестабилен**: ручная проверка GraphQL через живое приложение обязательна; автоматизация — позже через E2E (Playwright).
- **WSL↔Windows сеть**: доступ к `http://localhost:8080` из Windows должен работать. Если нет — проверить файрвол Windows и порты.

## Итоговые результаты (факт от 2025-11-16)
- JAR собран и запущен в WSL, доступ из Windows браузера
- Smoke UI и API (REST/GraphQL) пройдены, получены корректные данные (3 записи)
- Устойчивость подтверждена: восстановление после кратковременной недоступности БД, перезапуск приложения сохраняет настройки
- Документация обновлена: journal и development JSON (этап 03.7)
