**Дата:** 2025-11-11  
**Автор:** Александр  
**Связанные задачи:** task:0003, task:0015, task:0017, task:0018

## Контекст
- Структурный план вынесен из `docs/development/project-development.json` для оперативного сопровождения в чатах.  
- K1 (REST/GraphQL API для Og/OgAg) закрыта 2025-11-11 вместе с интеграционным тестом `ApiOrganizationsSuccessIT` и ручной проверкой.  
- Этапы 2 и 3 сосредоточены на пользовательском UI и CI-пайплайнах, опираются на готовый backend.

## Структурный план (№ 00)
- ✅ 01.0 Этап 1 ― API для OgService/OgAgService (связь: task:0002, task:0003, task:0007)
  - ✅ 01.1 Актуализация моделей и требований по данным (task:0003, task:0013, task:0014)
  - ✅ 01.2 Проектирование DTO слоев и мапперов (task:0016) — завершено 2025-11-13
  - ✅ 01.3 Описание и выравнивание REST/GraphQL контрактов (task:0007, предложение task:0017)
  - ✅ 01.4 Реализация и интеграционные проверки API (выход на контрольную точку K1)
    - ✅ 01.4.1 Автотесты сервисов/мэпперов (task:0003)
    - ✅ 01.4.2 Ручной прогон через браузер/REST-клиент (контрольная точка K1)
- ✅ 02.0 Этап 2 ― Интерфейс просмотра организаций и агентов (связь: task:0008) — закрыт 2025-11-13
  - ✅ 02.1 UX-флоу подключения и выбора таблиц
    - ✅ 02.1.1 Каркас приложения с кнопками и строкой состояния (постоянный layout) — см. [docs/development/notes/UI/02-1-1_app-layout.md](./UI/02-1-1_app-layout.md)
    - ✅ 02.1.2 Сценарий модальной формы подключения (поля, действия, изменение статуса) — см. [docs/development/notes/UI/02-1-2_connection-modal.md](./UI/02-1-2_connection-modal.md)
    - ✅ 02.1.3 UX-описание экрана организаций (таблица, детали, список агентов) — см. [docs/development/notes/UI/02-1-3_organizations-screen.md](./UI/02-1-3_organizations-screen.md)
    - ✅ 02.1.4 Пользовательские сценарии «подключение → просмотр организаций» — см. [docs/development/notes/UI/02-1-4_connection-to-organizations-flow.md](./UI/02-1-4_connection-to-organizations-flow.md)
    - ✅ 02.1.Q Перевод UI на Quasar (layout, модалка, экран организаций)
      - ✅ 02.1.Q.0 Подготовка модуля `femsq-frontend-q` (инициализация проекта, зависимости Quasar, базовая конфигурация)
      - ✅ 02.1.Q.1 Каркас приложения на Quasar (повторное исполнение 02.1.1)
      - ✅ 02.1.Q.2 Модальное подключение на Quasar (повторное исполнение 02.1.2)
      - ✅ 02.1.Q.3 Экран организаций на Quasar (повторное исполнение 02.1.3)
    - **→ project-development:** «UX-макет подключения и просмотра организаций (task:0018, блок 02.1)», «Переход UI на Quasar (task:0020, блок 02.1.Q)»
  - ✅ 02.2 Реализация компонентов списка/детализации и связка с API (контрольная точка K2) — закрыта 2025-11-13
    - ✅ 02.2.1 Интеграция Pinia-стора с REST/GraphQL API (загрузка организаций, агентов, обработка ошибок) — реализовано в `code/femsq-frontend-q/src/stores/organizations.ts`
    - ✅ 02.2.2 Расширение OrganizationsView фильтрами, пагинацией и состояниями загрузки — реализовано в `code/femsq-frontend-q/src/views/organizations/OrganizationsView.vue`
    - ✅ 02.2.3 Подготовка e2e/unit тестов для сценариев K2 и проверка контрольной точки
      - ✅ 02.2.3.1 Настроить инфраструктуру тестирования (Vitest, Cypress, конфиги, npm-скрипты)
      - ✅ 02.2.3.2 Написать unit-тесты для `useOrganizationsStore` (фильтры, пагинация, обработка ошибок)
      - ✅ 02.2.3.3 Реализовать компонентные тесты `OrganizationsView` с моками API — см. `code/femsq-frontend-q/tests/component/OrganizationsView.spec.ts`
      - ✅ 02.2.3.4 Подготовить e2e-сценарии K2 (успех, пустая выборка, ошибка API, фильтр/пагинация) — см. `code/femsq-frontend-q/cypress/e2e/organizations.cy.ts`
      - ✅ 02.2.3.4.P Миграция e2e-тестов на Playwright (замена Cypress)
        - ✅ 02.2.3.4.P.1 Удалить Cypress из зависимостей и установить Playwright
        - ✅ 02.2.3.4.P.2 Настроить конфигурацию Playwright (playwright.config.ts, браузеры, baseURL) — см. `code/femsq-frontend-q/playwright.config.ts`
        - ✅ 02.2.3.4.P.3 Переписать e2e-тесты на Playwright (организации, фильтры, пагинация, ошибки) — см. `code/femsq-frontend-q/tests/e2e/organizations.spec.ts`
        - ✅ 02.2.3.4.P.4 Обновить npm-скрипты и документацию (package.json, README, project-development.json)
      - ✅ 02.2.3.5 Сформировать чеклист K2 и зафиксировать контрольную точку в документации/журнале — см. [docs/development/notes/K2-checklist.md](./K2-checklist.md)
  - ✅ 02.3 Минимальные UX-тесты и обратная связь — см. [docs/development/notes/UI/02-3_ux-tests-checklist.md](./UI/02-3_ux-tests-checklist.md)
  - ✅ 02.4 Динамическое подключение к БД через UI — см. [docs/development/notes/02-4_dynamic-db-connection-proposal.md](./02-4_dynamic-db-connection-proposal.md) — закрыт 2025-11-13
    - ✅ 02.4.1 Backend API для управления подключением
      - ✅ 02.4.1.1 Добавить поддержку схемы в конфигурацию (расширить DatabaseConfigurationProperties) ⚠️ КРИТИЧНО — нужно первым
      - ✅ 02.4.1.2 Добавить DTO для запросов/ответов (ConnectionTestRequest, ConnectionStatusResponse, ConnectionConfigResponse)
      - ✅ 02.4.1.3 Создать `ConnectionController` с endpoints (GET /status, POST /test, POST /apply, GET /config)
      - ✅ 02.4.1.4 Реализовать тестирование подключения (без сохранения конфигурации) в контроллере
      - ✅ 02.4.1.5 Реализовать механизм переподключения (ConnectionManager с динамическим обновлением)
      - ✅ 02.4.1.6 Реализовать применение конфигурации (сохранение и переподключение через ConnectionManager)
      - ✅ 02.4.1.7 Добавить поддержку внешнего пути к конфигурации (для production через -Dfemsq.config.path)
    - ✅ 02.4.2 Обновление DAO для поддержки динамической схемы
      ⚠️ Можно начинать ПОСЛЕ 02.4.1.1 (параллельно с 02.4.1.2-02.4.1.7)
      - ✅ 02.4.2.1 Обновить `JdbcOgDao` для использования схемы из конфигурации
      - ✅ 02.4.2.2 Обновить `JdbcOgAgDao` для использования схемы из конфигурации
      - ✅ 02.4.2.3 Протестировать работу с разными схемами
    - ✅ 02.4.3 Frontend интеграция с API подключения
      ⚠️ 02.4.3.1 можно делать параллельно с backend; 02.4.3.2-02.4.3.4 требуют готовности API (минимум 02.4.1.3)
      - ✅ 02.4.3.1 Добавить `apiPost` в HTTP клиент (можно параллельно с backend)
      - ✅ 02.4.3.2 Заменить демо-логику на реальные API вызовы в `App.vue`
      - ✅ 02.4.3.3 Добавить обработку ошибок подключения
      - ✅ 02.4.3.4 Обновить UI для отображения реального статуса подключения
    - ✅ 02.4.4 Тестирование динамического подключения
      ⚠️ 02.4.4.1 можно делать параллельно с разработкой контроллера; 02.4.4.2 после 02.4.1.6; 02.4.4.3 после 02.4.3.2
      - ✅ 02.4.4.1 Unit тесты для `ConnectionController` (параллельно с 02.4.1.3-02.4.1.6)
      - ✅ 02.4.4.2 Integration тесты для переподключения (после 02.4.1.6)
      - ✅ 02.4.4.3 E2E тесты для смены схемы через UI (после 02.4.3.2)


- ✅ 03.0 Документация и синхронизация артефактов
  - ✅ 03.1 Обновление project-docs.json и расширений (в привязке к module:backend.web, module:frontend)
  - ✅ 03.2 Актуализация project-development.json (вставка новых задач, обновление displayName)
  - ✅ 03.3 Журналирование прогресса в project-journal.json (включая отметки по контрольным точкам K1/K2)

## Контрольные точки
- K1 ― API доступно в браузере/REST-клиенте (закрывает блок 01.4; в рамках task:0007) — ✅ закрыта 2025-11-11
- K2 ― Фронтенд-интерфейс показывает данные og/ogAg (закрывает блок 02.2; в рамках task:0008) — ✅ закрыта 2025-11-13

## Статус плана
- ✅ **Этап 1 (01.0)** — завершен (K1 закрыта 2025-11-11)
- ✅ **Этап 2 (02.0)** — завершен (K2 закрыта 2025-11-13)
  - ✅ UX-флоу и UI компоненты (02.1) — завершены
  - ✅ Реализация и интеграция с API (02.2) — завершена
  - ✅ UX-тесты (02.3) — завершены
  - ✅ Динамическое подключение к БД (02.4) — завершено
- ✅ **Этап 3 (03.0)** — завершен (документация синхронизирована)

**Примечание:** Задача 01.2 (Проектирование DTO слоев и мапперов) завершена — все DTO и мапперы реализованы, протестированы и задокументированы.

## Предложения по следующим шагам
1. Продолжить разработку следующих экранов и компонентов на основе готового каркаса и паттернов.  
2. Реализовать улучшения из UX-тестов (toast-уведомления, tooltips, виртуализация таблиц) по мере необходимости.
3. Расширить функциональность системы тестирования (добавить теги JUnit 5, Testcontainers, pre-commit hooks).
4. Оптимизировать производительность при работе с большими объемами данных (пагинация, кэширование).

