# Архитектура планирования разработки v2.0

**Версия:** 2.0.0  
**Дата:** 2025-10-09

---

## Концептуальная модель

```
┌─────────────────────────────────────────────────────────────┐
│                project-development.json v2.0                │
└─────────────────────────────────────────────────────────────┘
                              │
                ┌─────────────┴─────────────┐
                │                           │
        ┌───────▼───────┐          ┌────────▼────────┐
        │    tasks      │          │   structure     │
        │   (словарь)   │          │  (иерархия)     │
        └───────┬───────┘          └────────┬────────┘
                │                           │
                │                   ┌───────┴───────┐
                │                   │               │
        ┌───────▼───────┐   ┌───────▼───────┐     ...
        │  Task         │   │ Tree (01)     │
        │  (0001)       │   │               │
        │               │   │ displayName   │
        │ displayName   │   │ tree-attrs    │
        │ task-attrs {  │   │ task-items[]  │
        │   status      │   │               │
        │   priority    │   │     │         │
        │   completion  │   │     ▼         │
        │   Criteria[]  │   │ ┌─────────┐   │
        │   owner       │   │ │TaskItem │   │
        │   description │   │ │         │   │
        │   links       │   │ │ taskId──┼───┘
        │ }             │   │ │   │     │
        └───────────────┘   │ └───┼─────┘
                            │     │
                            └─────┘
                            
     Связь: TaskItem.taskId → Task.id
     Синхронизация: Task.status → TaskItem.displayName
```

---
## Диаграмма классов

```
┌─────────────────────────────┐
│   TaskStructureElement      │  (абстрактный)
├─────────────────────────────┤
│ + id: string                │
│ + created: date             │
│ + lastUpdated: date         │
└──────────┬──────────────────┘
           │
     ┌─────┴─────┐
     │           │
┌────▼──────┐   ┌▼──────────────────────┐
│   Task    │   │ TaskItem              │
├───────────┤   ├───────────────────────┤
│ id: 0001  │◄──┤ structureId: 01.01.01 │
│           │   │ taskId: 0001          │
│ display   │   │ positionInParent: 1   │
│ Name      │   │                       │
│ status    │   │ displayName (с emoji) │
│ priority  │   │ item-attributes { }   │
│ owner     │   │ task-items[]          │
│ completion│   │   │                   │
│ Criteria[]│   │   └──► TaskItem       │
│ descrip   │   │          (рекурсия)   │
│ tion      │   │                       │
│ links     │   └───────────────────────┘
└───────────┘
     ▲
     │
     └─── может быть в нескольких
          TaskItem (DAG)


┌───────────────────────────┐
│   Tree                    │
├───────────────────────────┤
│ treeNumber: 01            │
│ treeId: artifacts         │
│ type: artifacts           │
│ description               │
│ positionInParent: 1       │
│                           │
│ displayName               │
│ tree-attributes { }       │
│ task-items[]              │
│   │                       │
│   └──► TaskItem           │
└───────────────────────────┘
```

---
## Пример структуры данных

### tasks (плоский словарь)

```json
{
  "0001": { "task": {...описание задачи...} },
  "0002": { "task": {...описание задачи...} },
  "0003": { "task": {...описание задачи...} }
}
```

### structure (иерархические деревья)

```json
{
  "trees": [
    {
      "tree": {
        "displayName": "Дерево артефактов. № 01",
        "tree-attributes": {"treeNumber": "01", ...},
        "task-items": [
          {
            "task-item": {
              "displayName": "🔄 Backend (in-progress, critical). № 01.01 → 0002",
              "item-attributes": {"taskId": "0002", ...},
              "task-items": [
                {
                  "task-item": {
                    "displayName": "⏳ Config (pending, high). № 01.01.01 → 0003",
                    "item-attributes": {"taskId": "0003", ...},
                    "task-items": []
                  }
                }
              ]
            }
          }
        ]
      }
    }
  ]
}
```

---

## Связи между сущностями

### 1:N - Задача → Пункты структуры

```
Task (0004) ──┬──► TaskItem (01.01.01.01) в дереве 01
              ├──► TaskItem (02.01.01) в дереве 02
              └──► TaskItem (0a.01.01) в дереве 0a
```

**Значение:** Одна задача может быть в нескольких местах структуры.

**Синхронизация:** При изменении status в Task автоматически обновляется displayName во всех TaskItem.

---
## Нумерация

### Задачи (Tasks)

```
Формат: 0001, 0002, 0003, ...
Тип: Сквозная нумерация по возрастанию
Уникальность: Глобально уникальные
```

### Деревья (Trees)

```
Формат: 01, 02, 03, ..., 0a, 0b, ..., zz
Тип: По правилам structural-numbering.md
Уникальность: Глобально уникальные

Примеры:
01 - Дерево артефактов
02 - Дерево функционала
0a - Дерево модулей
```

### Пункты структуры (TaskItems)

```
Формат: [treeNumber].[localNumber].[localNumber]...
Тип: Иерархическая нумерация с номером дерева
Уникальность: Глобально уникальные

Примеры:
01.01       - Backend модуль (в дереве 01)
01.01.01    - Config компонент (в дереве 01)
02.01       - Функция подключения (в дереве 02)
02.01.01    - Загрузка конфигурации (в дереве 02)
0a.01.01    - Конфигурация БД (в дереве 0a)
```

---

## Эмодзи и статусы

### Карта эмодзи

| Статус | Эмодзи | Использование |
|--------|--------|---------------|
| `pending` | ⏳ | В displayName пунктов |
| `in-progress` | 🔄 | В displayName пунктов |
| `completed` | ✅ | В displayName пунктов |
| `blocked` | 🚫 | В displayName пунктов |
| `cancelled` | ❌ | В displayName пунктов |

### Синхронизация статусов

```
1. Изменить status в Task
2. Обновить displayName в Task
3. Найти все TaskItem с taskId == Task.id
4. Обновить displayName в каждом TaskItem (включая эмодзи)
```

**Результат:** Статус визуально одинаков везде, где задача используется.

---
## Навигация

### Компактный вид (свернуто)

```
▼ tasks
  ▼ items
    ► 0001
    ► 0002
    ► 0003
▼ structure
  ▼ trees
    ▼ [0]
      ▼ tree
        displayName: "Дерево артефактов. № 01"
        ▼ task-items
          ▼ [0]
            ▼ task-item
              displayName: "🔄 Backend модуль (in-progress). № 01.01 → 0002"
              ▼ task-items
                ▼ [0]
                  ▼ task-item
                    displayName: "⏳ Модуль конфигурации (pending). № 01.01.01 → 0003"
```

**Преимущества:**
- Быстрый просмотр структуры
- Минимум вертикального пространства
- Эмодзи для быстрой визуальной индикации
- Удобная навигация по displayName

### Развернутый вид (одного пункта)

```
▼ task-item
  displayName: "🔄 Backend модуль (in-progress, critical). № 01.01 → 0002"
  ▼ item-attributes
    structureId: "01.01"
    taskId: "0002"
    positionInParent: 1
  ▼ task-items
    ► [0] task-item
    ► [1] task-item
```

---

## Визуализация иерархии

```
project-development.json
│
├─── tasks (словарь задач)
│    ├─── 0001: задача "Разработка проекта"
│    ├─── 0002: задача "Backend модуль"
│    ├─── 0003: задача "Модуль конфигурации"
│    ├─── 0004: задача "DatabaseConfigService"
│    ├─── 0005: задача "ConnectionManager"
│    └─── 0006: задача "Функционал подключения к БД"
│
└─── structure (деревья пунктов)
     ├─── Дерево 01 (артефакты)
     │    ├─── 01.01 → задача 0002
     │    │    ├─── 01.01.01 → задача 0003
     │    │    │    └─── 01.01.01.01 → задача 0004
     │    │    └─── 01.01.02 → задача 0005
     │    └─── 01.02 → задача 0010
     │
     ├─── Дерево 02 (функционал)
     │    └─── 02.01 → задача 0006
     │         ├─── 02.01.01 → задача 0004 (та же!)
     │         └─── 02.01.02 → задача 0005 (та же!)
     │
     └─── Дерево 0a (модули)
          └─── 0a.01 → null (группировочный)
               ├─── 0a.01.01 → задача 0004
               └─── 0a.01.02 → задача 0005
```

**Видно:** Задачи 0004 и 0005 используются в трёх разных деревьях с разными структурными номерами, но одним статусом!

---
## Преимущества архитектуры

### ✅ Разделение ответственности

- **Task** = ЧТО делать (содержание)
- **TaskItem** = ГДЕ в иерархии (навигация)
- **Tree** = КАК организовано (классификация)

### ✅ Единственный источник истины

Задача описана один раз в `tasks.items`, 
ссылки на нее из разных мест структуры.

### ✅ Поддержка DAG

Одна задача → множество пунктов структуры
(может быть в артефактах, функционале, модулях).

### ✅ Компактная навигация

Три элемента пункта:
- `displayName` - для быстрого просмотра (с эмодзи)
- `item-attributes` - свернутый узел атрибутов
- `task-items` - массив детей

### ✅ Визуальная индикация

Эмодзи статусов:
- ⏳ pending
- 🔄 in-progress
- ✅ completed
- 🚫 blocked
- ❌ cancelled

### ✅ Автоматическая синхронизация

При изменении статуса задачи автоматически обновляются displayName во всех связанных пунктах.

### ✅ Гибкость

Легко добавлять новые деревья:
- По фазам
- По приоритетам
- По ответственным
- Любая другая классификация

### ✅ Масштабируемость

- До 1295 деревьев верхнего уровня
- Бесконечная вложенность пунктов
- Неограниченное количество задач

---

## Заключение

Архитектура v2.0 обеспечивает:
- 🎯 Четкое разделение задач и структуры
- 🔗 Поддержку DAG для сложных связей
- 📊 Удобную навигацию в IDE
- 👁️ Визуальную индикацию статусов
- 🔄 Автоматическую синхронизацию
- ⚡ Простоту для solo-разработчика

---

**Автор:** Александр  
**Дата:** 2025-10-09
